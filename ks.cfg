# Generated by Anaconda 34.25.2.10
# Generated by pykickstart v3.32
#version=RHEL9
# Use text mode install
text
repo --name="AppStream" --baseurl=http://openstack01.openknowit.com:8000/rhel-9.2/AppStream

%addon com_redhat_kdump --disable

%end

# System language
lang en_DK.UTF-8

# Use network installation
url --url="http://openstack01.openknowit.com:8000/rhel-9.2"

# Reboot after the kickstart process is finished
# HERE is the reboot command
reboot

%packages
@^minimal-environment

%end

# Run the Setup Agent on first boot
firstboot --enable
# Do not configure the X Window System
skipx

# Generated using Blivet version 3.6.0
ignoredisk --only-use=vda
# System bootloader configuration
bootloader --location=mbr --boot-drive=vda
autopart --type=thinp
# Partition clearing information
clearpart --all --initlabel --drives=vda

# System timezone
timezone Europe/Copenhagen --utc

# Root password
rootpw --iscrypted $6$5FjUDSrOrfKla1eC$Dk4naBHuSBb5E64asC/V8uu93HqHzOUb9B0k76SPDwC7P1Xkf/XEJWHSiz4C1ikTt8AxkCFhnUg6WZtjT6Mg7.

%post --interpreter=/usr/bin/bash
/usr/bin/touch /opt/keepkalm
/usr/bin/curl -o /etc/ssh/trusted-user-ca-keys.pem https://vault.openknowit.com/v1/ssh-client-signer/public_key
echo "AuthorizedPrincipalsFile /etc/ssh/AuthorizedPrincipals" >> /etc/ssh/sshd_config
echo "TrustedUserCAKeys /etc/ssh/trusted-user-ca-keys.pem"  >> /etc/ssh/sshd_config
echo "ubuntu" > /etc/ssh/AuthorizedPrincipals
sed -i 's/^MaxAuthTries 6$/MaxAuthTries 200/; s/^#* *PubkeyAuthentication .*/PubkeyAuthentication yes/' /etc/ssh/sshd_config
echo "Done" >> /opt/keepkalm





%end
